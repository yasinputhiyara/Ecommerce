<%- include("../partials/adminheader") %>
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.min.css'></link>

<div class="container-scroller">
  <!-- Sidebar -->
  <%- include("../partials/adminSidebar") %>

  <div class="container-fluid page-body-wrapper">
    <!-- Navbar -->
    <%- include("../partials/adminNav") %>

    <div class="main-panel">
      <div class="content-wrapper">
        
        <!-- Page Header -->
        <div class="page-header">
          <h3 class="page-title">Product Management</h3>
          <a href="/admin/add-product" class="btn btn-primary">Add Product</a>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb" style="color: red;">
              <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
              <li class="breadcrumb-item active" aria-current="page"><a href="#">Products</a></li>
            </ol>
          </nav>
        </div>

        <!-- Search Bar -->
        <div class="content-header text-center">
          <form action="" method="get" class="d-inline">
            <div class="input-group input-group-sm border border-1 border-grey rounded-pill" style="width: 500px; margin: auto;">
              <input 
                type="text" 
                class="form-control border-0 rounded-pill" 
                placeholder="Search products" 
                name="search" 
              />
              <button class="btn border-0" type="submit">Search</button>
            </div>
          </form>
        </div>

        <!-- Product Table -->
        <div class="right mt-5">
          <h2 class="content-title card-title text-center mb-4">Product List</h2>
          <table class="table table-striped table-bordered text-center">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Product Name</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% for (let i = 0; i < data.length; i++) { %>
              <tr>
                <!-- Product Name -->
                <td><%= data[i].productName %></td>

                <!-- Actions -->
                <td>
                  <!-- View Details Button -->
                  <button 
                    class="btn btn-info text-white me-2" 
                    data-bs-toggle="modal" 
                    data-bs-target="#productModal<%= i %>">
                    View Details
                  </button>

                  <!-- Block/Unblock Button -->
                  <% if (!data[i].isBlocked) { %>
                  <a 
                    href="/admin/blockProduct?id=<%= data[i]._id %>" 
                    class="btn btn-danger text-white me-2" 
                    style="text-decoration: none;">
                    Block
                  </a>
                  <% } else { %>
                  <a 
                    href="/admin/unblockProduct?id=<%= data[i]._id %>" 
                    class="btn btn-success text-white me-2" 
                    style="text-decoration: none;">
                    Unblock
                  </a>
                  <% } %>

                  <!-- Edit Button -->
                  <a 
                    href="/admin/edit-product/?id=<%= data[i]._id %>" 
                    class="btn btn-primary text-white" 
                    style="text-decoration: none;">
                    Edit
                  </a>
                </td>
              </tr>

              <!-- Product Details Modal -->

              <div class="modal fade" id="productModal<%= i %>" tabindex="-1" aria-labelledby="productModalLabel<%= i %>" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="productModalLabel<%= i %>"><%= data[i].productName %></h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <p><strong>Brand:</strong> <%= data[i].brand %></p>
                      <p><strong>Category:</strong> <%= data[i].category.name %></p>
                      <p><strong>Sale Price:</strong> <%= data[i].salePrice %></p>
                      <p><strong>Regular Price:</strong> <%= data[i].regularPrice %></p>
                      <p><strong>Quantity:</strong> <%= data[i].quantity %></p>
                      <p><strong>Description:</strong> <%= data[i].description %></p>
                      <p><strong>Status:</strong> <%= data[i].isBlocked ? "Blocked" : "Active" %></p>
                      <div>
                        <strong>Product Images:</strong>
                        <div class="d-flex flex-wrap">
                          <% for (let image of data[i].productImages) { %>
                            <img 
                              src="/resized-images/<%= image %>" 
                              alt="Product Image" 
                              class="img-thumbnail m-2" 
                              style="width: 150px; height: 150px;">
                          <% } %>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>

              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<%- include("../partials/adminfooter") %>
